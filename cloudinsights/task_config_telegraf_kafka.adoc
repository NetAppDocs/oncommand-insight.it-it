---
sidebar: sidebar 
permalink: task_config_telegraf_kafka.html 
keywords: telegraf, installation, install, kafka 
summary: Configurazione del data collector Kafka 
---
= Data Collector Kafka
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Cloud Insights utilizza questo data collector per raccogliere le metriche da Kafka.



== Installazione

. Da *osservabilità > Collector*, fare clic su *+Data Collector*. Scegli Kafka.
+
Selezionare il sistema operativo o la piattaforma su cui è installato Telegraf Agent.

. Se non è già stato installato un Agent per la raccolta o se si desidera installare un Agent per un sistema operativo o una piattaforma differente, fare clic su _Show Instructions_ (Mostra istruzioni) per espandere la link:task_config_telegraf_agent.html["Installazione dell'agente"] istruzioni.
. Selezionare il tasto di accesso dell'agente da utilizzare con questo data collector. È possibile aggiungere un nuovo Agent Access Key facendo clic sul pulsante *+ Agent Access Key*. Best practice: Utilizzare un Agent Access Key diverso solo quando si desidera raggruppare i data raccoglitori, ad esempio per sistema operativo/piattaforma.
. Seguire la procedura di configurazione per configurare il data collector. Le istruzioni variano a seconda del tipo di sistema operativo o piattaforma utilizzata per la raccolta dei dati.


image:KafkaDCConfigWindows.png["Configurazione di Kafka"]



== Setup (Configurazione)

Il plugin Kafka si basa sul plugin di telegraf, Jolokia. Come requisito per raccogliere informazioni da tutti i broker Kafka, JMX deve essere configurato ed esposto tramite Jolokia su tutti i componenti.



=== Compatibilità

La configurazione è stata sviluppata rispetto alla versione 0.11.0 di Kafka.



=== Configurazione

Tutte le istruzioni riportate di seguito presuppongono che la posizione di installazione di kafka sia "/opt/kafka". È possibile adattare le istruzioni riportate di seguito in base alla posizione di installazione.



==== Jolokia Agent Jar

Una versione del file Jar dell'agente di Jlokia link:https://jolokia.org/download.html["scaricato"]. La versione testata era l'agente di Jookia 1.6.0.

Le istruzioni riportate di seguito presuppongono che il file jar scaricato (jookia-jvm-1.6.0-Agent.jar) si trovi nella posizione '/opt/kafka/libs/'.



==== Kafka Brokers

Per configurare i broker Kafka in modo che espongano l'API di Jokia, è possibile aggiungere quanto segue in <KAFKA_HOME>/bin/kafka-server-start.sh, appena prima della chiamata 'kafka-run-class.sh':

[listing]
----
export JMX_PORT=9999
export RMI_HOSTNAME=`hostname -I`
export KAFKA_JMX_OPTS="-javaagent:/opt/kafka/libs/jolokia-jvm-1.6.0-agent.jar=port=8778,host=0.0.0.0  -Dcom.sun.management.jmxremote.password.file=/opt/kafka/config/jmxremote.password -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=$RMI_HOSTNAME -Dcom.sun.management.jmxremote.rmi.port=$JMX_PORT"
----
Si noti che l'esempio precedente utilizza 'hostname -i' per impostare la variabile di ambiente 'RMI_HOSTNAME'. In più computer IP, questo dovrà essere modificato per raccogliere l'IP che si occupa delle connessioni RMI.

È possibile scegliere una porta diversa per JMX (9999 sopra) e Jlokia (8778). Se si dispone di un IP interno su cui bloccare Jolokia, è possibile sostituire il "catch all" 0.0.0.0 con il proprio IP. Si noti che questo IP deve essere accessibile dal plugin telegraf. Se non si desidera autenticare, è possibile utilizzare l'opzione '-Dcom.sun.management.jmxremote.authenticate=false'. Utilizzare a proprio rischio.



== Oggetti e contatori

Vengono raccolti i seguenti oggetti e i relativi contatori:

[cols="<.<,<.<,<.<,<.<"]
|===
| Oggetto: | Identificatori: | Attributi: | Punti dati: 


| Broker Kafka | Cluster
Namespace
Broker | Nome del nodo
IP nodo | Tag max Fetcher Manager di replica
Connessioni client Zookeeper
Connessioni client Zookeeper (15m rate)
Connessioni client Zookeeper (5m rate)
Connessioni client Zookeeper (velocità media)
Connessioni client Zookeeper (1m rate)
Conteggio partizioni di Replica Manager
Daemon conteggio thread
Picco conteggio thread
Corrente conteggio thread
Totale conteggio thread iniziato
Partizioni offline
Tempo totale richieste di produzione (50th percentile)
Tempo totale richieste di produzione (75th percentile)
Tempo totale richieste di produzione (95th percentile)
Tempo totale richieste di produzione (98 percentile)
Tempo totale richieste di produzione (999th percentile)
Tempo totale richieste di produzione (99th percentile)
Tempo totale richieste di produzione
Tempo totale richieste produzione Max
Media tempo totale richieste di produzione
Tempo totale richieste produzione min
Produrre richieste tempo totale Stddev
Replica Manager ISR si riduce
Replica Manager ISR si restringe (15m rate)
Replica Manager ISR si restringe (5m rate)
Riduzione dell'ISR di Replication Manager (tasso medio)
Replica Manager ISR si restringe (1m rate)
Richiesta di inattività media gestore
Richiesta gestore inattività media (15m rate)
Richiesta gestore inattività media (5m rate)
Inattività media gestore richieste (media)
Richiesta gestore inattività media (1m rate)
Garbage Collection G1 Conteggio vecchia generazione
Garbage Collection G1 tempo di vecchia generazione
Garbage Collection G1 Conteggio giovani generazioni
Garbage Collection G1 Young Generation Time
Zookeeper si connette solo in lettura
Connessione di sola lettura Zookeeper (15m rate)
Connessione di sola lettura Zookeeper (5m rate)
Connessione di sola lettura Zookeeper (velocità media)
Connessione di sola lettura Zookeeper (1m rate)
Processore di rete inattivo medio
Richieste Fetch follower tempo totale (50th percentile)
Richieste Fetch follower tempo totale (75th percentile)
Richieste Fetch follower tempo totale (95th percentile)
Richieste Fetch follower tempo totale (98th percentile)
Richieste Fetch follower tempo totale (999th percentile)
Richieste Fetch follower tempo totale (99th percentile)
Richiede tempo totale Fetch follower
Richieste tempo totale inseguitore recupero max
Richiede Fetch follower Total Time Mean
Richiede tempo totale inseguitore recupero min
Richiede Fetch follower tempo totale Stddev
Richieste in attesa di produrre Purgatory
La rete richiede il recupero del consumatore
Richieste di rete Fetch Consumer (5m rate)
Richieste di rete Fetch Consumer (15m rate)
Richieste di rete Fetch Consumer (velocità media)
Richieste di rete Fetch Consumer (1m rate)
Elezioni dei leader impuri
Elezioni dei leader impuri (tasso 15m)
Elezioni dei leader impuri (tasso 5m)
Elezioni leader immondi (tasso medio)
Elezioni dei leader impuri (tasso 1m)
Controller attivi
Memoria heap impegnata
Inizializzazione memoria heap
Memoria heap max
Memoria heap utilizzata
La sessione Zookeeper scade
La sessione Zookeeper scade (tariffa 15m)
La sessione Zookeeper scade (tariffa 5m)
Scadenza sessione Zookeeper (tariffa media)
La sessione Zookeeper scade (tariffa 1m)
Errori di autenticazione Zookeeper
Errori di autenticazione Zookeeper (15m rate)
Errori di autenticazione Zookeeper (5m rate)
Errori di autenticazione Zookeeper (velocità media)
Errori di autenticazione Zookeeper (1m rate)
Ora elezione leader (50th percentile)
Ora elezione leader (75th percentile)
Ora elezione leader (95th percentile)
Ora elezione leader (98th percentile)
Ora elezione leader (999th percentile)
Ora elezione leader (99th percentile)
Conteggio elezioni leader
Ora elezione leader (15m rate)
Ora elezione leader (5m rate)
Tempo elezione leader max
Tempo delle elezioni leader medio
Ora elezione leader (media)
Tempo elezione leader min
Ora elezione leader (1m rate)
Tempo elezione leader (stddev)
Network richiede Fetch follower
Network richiede Fetch follower (velocità 15m)
Network richiede Fetch follower (velocità 5m)
Network Requests Fetch follower (velocità media)
Network richiede Fetch follower (velocità 1m)
Messaggi degli argomenti del broker
Messaggi di argomento del broker (15m rate)
Messaggi di argomento del broker (5m rate)
Messaggi di argomento del broker (media)
Messaggi di argomento del broker (1m rate)
Byte argomento broker in
Byte argomento broker in (15m rate)
Byte argomento broker in (5m rate)
Byte argomento broker in (velocità media)
Byte argomento broker in (1m rate)
Zookeeper disconnette il conteggio
Zookeeper si scollega (tariffa 15m)
Zookeeper si scollega (tariffa 5m)
Disconnessione Zookeeper (tasso medio)
Zookeeper si scollega (tariffa 1m)
Richieste di rete recupero tempo totale consumatori (50th percentile)
Richieste di rete recupero tempo totale consumatori (75th percentile)
Richieste di rete recupero tempo totale consumatori (95th percentile)
Richieste di rete recupero tempo totale consumatori (98th percentile)
Richieste di rete recupero tempo totale consumatori (999th percentile)
Richieste di rete recupero tempo totale consumatori (99th percentile)
Richieste di rete recupero tempo totale cliente
Richieste di rete recupero tempo totale cliente Max
Richieste di rete recupero media tempo totale cliente
Richieste di rete recupero tempo totale cliente min
Richieste di rete recupero Consumer tempo totale Stddev
Conteggio leader
Richieste in attesa in Fetch Purgatory
Byte dell'argomento del broker
Byte argomento broker in uscita (15m rate)
Byte argomento broker in uscita (5m rate)
Byte argomento broker in uscita (velocità media)
Byte argomento broker in uscita (1m rate)
Autenticazioni Zookeeper
Autenticazioni Zookeeper (15m rate)
Autenticazioni Zookeeper (5m rate)
Autenticazioni Zookeeper (tasso medio)
Autenticazioni Zookeeper (1m rate)
Numero di prodotti richieste
Richieste prodotti (15m rate)
Richieste prodotti (5m rate)
Produzione richieste (media)
Richieste prodotti (1m rate)
Replica Manager ISR si espande
Espansioni ISR di Replication Manager (velocità 15m)
Espansioni ISR di Replication Manager (velocità 5m)
Espansioni ISR di Replication Manager (frequenza media)
Espansioni ISR di Replication Manager (velocità 1m)
Replication Manager sotto partizioni replicate 
|===


== Risoluzione dei problemi

Per ulteriori informazioni, consultare link:concept_requesting_support.html["Supporto"] pagina.
